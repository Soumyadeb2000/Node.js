<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container" style="margin-top: 1rem;">
        <div class="row">
            <div class="col-12">
                <h1 class="fw-bolder text-center" style="font-family: sans-serif; color:mediumaquamarine;">EXPENSE MANAGER</h1>
            </div>
            <div class="m-2 col-12 " style="background-color:mediumaquamarine ;">
                <h3 style="color: white;">Expenses</h3>
            </div>
            <div class="row-cols-lg">
                <ul id="list-group">
                
                </ul>
            </div>
            
            <div class="col-md-6 offset-md-3 border p-3 md-3 shadow" style="background-color: mediumaquamarine; margin-top: 10rem;">
                <form method="POST" onsubmit="saveExpense(event)">
                    <div class="col-6">
                        <label for="amount"></label>
                        <input type="number" name="amount" id="amount" class="form-control" placeholder="Amount" required>    
                    </div>
                    <label for="category"></label>
                    <div class="col-6">
                        <select class="form-select" name="category" id="category" placeholder="Category">
                            <option value="food">Food</option>
                            <option value="rent">Rent</option>
                            <option value="grocery">Grocery</option>
                            <option value="vehicle">Vehicle</option>
                            <option value="outing">Outing</option>
                            <option value="miscellaneous">Miscellaneous</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label for="description"></label>
                        <input type="text" name="description" id="description" class="form-control" placeholder="Description">    
                    </div>
                    <input type="submit" value="Add expense" class="btn btn-light float-end" style="border-color: mediumaquamarine;">
                </form>
            </div>
        </div>
    </div>
    <script>
        function saveExpense(event) {
            event.preventDefault();
            const amount = event.target.amount.value;
            const category = event.target.category.value;
            const description = event.target.description.value;
            // const loginId = localStorage.getItem("loginId");
            const obj = {
                amount, category, description
            };
            try {
                const token = localStorage.getItem("token");
                axios.post("http://localhost:3000/expense/add-expense", obj, {headers: {'Authorization': token}});
                showOnScreen(obj);
            } catch (error) {
                console.log(error);
            }
        }

        function showOnScreen(data) {
            let parentElm = document.getElementById('list-group');
            let childElm = document.createElement('li')
            childElm.textContent = "Amount: Rs." + data.amount + " -  Category: " + data.category + " -  Description: " + data.description + " ";
            parentElm.appendChild(childElm);
            const deleteBtn = document.createElement('input');
            deleteBtn.type = 'button';
            deleteBtn.value = 'Delete';
            childElm.appendChild(deleteBtn);
            deleteBtn.onclick = () => {
            try {
                const token = localStorage.getItem('token');
                axios.delete(`http://localhost:3000/expense/delete-expense/${data.id}`, {headers: {"Authorization": token}});
                parentElm.removeChild(childElm);
            } catch (error) {
                console.log(error);
            }
            }
        }

        window.addEventListener('DOMContentLoaded', async () => {
            try {
                const token = localStorage.getItem('token');
                let response = await axios.get('http://localhost:3000/expense/get-expense', {headers: {"Authorization": token}});
                for(let i=0 ; i<response.data.expenses.length ; i++) {
                    showOnScreen(response.data.expenses[i]);
                }
            } catch (error) {
                console.log(error);
            }
        })
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
</body>
</html>